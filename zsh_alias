alias rm='rm -i'
alias mv='mv -i'
alias cp='cp -i'
alias mkdir='mkdir -p'

alias vi="vim"
alias e='emacs -nw'
alias j="jobs -l"
alias grep='grep --colour --exclude-dir=".svn"'

alias leiser='amixer -q -c 0 sset Master 5%- unmute'
alias lauter='amixer -q -c 0 sset Master 5%+ unmute'

alias total-play-time='bc <<< "$(find -name "*.mp3" -print0 | xargs -0 mp3info -p "%S\n" | paste -sd+ | bc) / 60" '

alias vbox='VBoxManage startvm'
alias nb='newsbeuter'
alias pb='podbeuter'

alias svn-url='svn info | grep -i url | cut -d " " -f 2'

alias bc='bc -ql'

alias unrar-anyway='unrar x -kb -y'

alias droid='adb shell busybox'
alias dbox='dropbox'

alias dbox-crazy='echo 100000 | sudo tee /proc/sys/fs/inotify/max_user_watches'

alias psc='ps xawf -eo pid,user,cgroup,args'

alias mem-usage="ps aux | awk '{sum +=\$4}; END {print sum}'"

alias privoxy-socks="privoxy $HOME/.privoxy.conf"

if [ -e /usr/bin/service ]; then
	start(){ service $1 start }
	status(){ service $1 status }
	stop(){ service $1 stop }
	restart(){ service $1 restart }
fi

if [ -e /usr/bin/systemctl ]; then
	alias start='sudo systemctl start'
	alias stop='sudo systemctl stop'
	alias status='sudo systemctl status'
	alias restart='sudo systemctl restart'
fi

# Automatically background processes (no output to terminal etc)
alias z='echo $RANDOM > /dev/null; zz'
zz() {
	echo $*
	$* &> "/tmp/z-$1-$RANDOM" &!
}

for i in mupdf zathura firefox; do
	alias "$i=z $i"
done

GRC=`which grc`
if [ $? = 0 ]; then
	alias colourify="$GRC -es --colour=auto"
	alias diff='colourify diff'
	alias make='colourify make'
	# alias gcc='colourify gcc'
	alias g++='colourify g++'
	alias as='colourify as'
	alias ld='colourify ld'
	alias netstat='colourify netstat'
	alias ping='colourify ping'
	alias traceroute='colourify /usr/sbin/traceroute'
fi

wow(){
	unrar x $1 && rm -f Readme.png $1
}

view-tex(){
	xelatex "$1" && mupdf "${1%.*}.pdf"
}

# uname -a | grep -i ubuntu > /dev/null && alias 'pkg-install=sudo apt-get install'
# uname -a | grep -i ubuntu > /dev/null && alias 'pkg-search=apt-cache search'

which apt-get &> /dev/null
if [ $? = 0 ]; then
	yaourt(){
		results="$(apt-cache search $1)"
		echo "$results" | cat -n
		echo -n "==> "
		read num
		selected=$(sed -n "$num s/\([^ ]\) .*/\1/p" <<< "$results")
		echo "selected package: $selected"
		sudo apt-get install $selected
	}
fi


bright(){
	brightness=`echo "$1 * 0.1" | bc`
	redshiftgui -o -b $brightness
}

_bright(){
	A=( 5 6 7 8 9 10 )
	_arguments \
		 ":::($A)"
}
compdef _bright bright

alias chrome='z google-chrome --disk-cache-dir="/dev/shm/chrome/" &'
alias chrome-proxy='z google-chrome --disk-cache-dir="/dev/shm/chrome/" --proxy-server="socks5://localhost:7070" &'
alias chrome-dev='z google-chrome --disk-cache-dir="/dev/shm/chrome/" --allow-file-access-from-files  --disable-web-security --remote-debugging-port=9222 &'

alias play2='mplayer -ao alsa:device=hw=2.0'
alias play='mplayer'
alias play-mute='mplayer -ao null -idx'
alias playlist="find . -iname '*.mp3'"

alias datafart='curl --data-binary @- datafart.com'

alias notebook='ipython notebook --pylab=inline'
alias cling='cling  -Wc++11-extensions -std=c++11'
alias composer='composer.phar'
alias phplint='find . -name "*.php" -exec php -l {} \; | grep -v "No syntax errors detected in"'

alias last-ips="last | awk '{print \$3}' | sort | uniq -c | sort -rnk1"

ghc-run(){
	ghc --make $1 && "./${1%.*}"
}

alias get-jquery='wget http://code.jquery.com/jquery-1.8.3.min.js'
alias get-jquery='wget http://code.jquery.com/jquery-1.9.1.min.js'
alias get-bootstrap-datepicker='wget https://raw.github.com/eternicode/bootstrap-datepicker/master/js/bootstrap-datepicker.js'
alias get-mustache='wget https://raw.github.com/janl/mustache.js/master/mustache.js'
alias get-hammer='wget https://raw.github.com/EightMedia/hammer.js/master/hammer.js'
alias get-zepto='wget http://zeptojs.com/zepto.min.js'
alias get-mocha='wget https://raw.github.com/visionmedia/mocha/master/mocha.js'
alias get-mocha-css='wget https://raw.github.com/visionmedia/mocha/master/mocha.css'
alias get-chai='wget https://raw.github.com/chaijs/chai/master/chai.js'
alias get-pathjs='wget https://raw.github.com/mtrpcic/pathjs/master/path.js'
alias get-knockout='wget http://knockoutjs.com/downloads/knockout-2.2.1.js'
alias get-moment='wget https://raw.github.com/timrwood/moment/2.0.0/min/moment.min.js'
alias get-uikit='wget http://visionmedia.github.com/uikit/build/ui.js'
alias get-uikit-css="wget http://visionmedia.github.com/uikit/build/ui.css"
alias get-chosen="wget https://raw.github.com/harvesthq/chosen/master/chosen/chosen.jquery.js"
alias get-chosen-css="wget https://raw.github.com/harvesthq/chosen/master/chosen/chosen.css"
alias get-spin="wget http://fgnass.github.com/spin.js/dist/spin.js"
alias get-es5-shim="wget https://raw.github.com/kriskowal/es5-shim/master/es5-shim.js"

whichweek(){
	week=`date -d "now" +%U`
	echo "$week + 1" | bc
}

svn-add-all(){
	svn st | grep '^?' | sed 's/^?[ \t]\+//' | xargs -i svn add {}
}

svn-diff-by-extension(){
	exts='';
	for i in "$@"; do
		if [ -z "$exts" ]; then
			exts="$exts -iname \"*.$i\"";
		else
			exts="$exts -o -iname \"*.$i\"";
		fi
	done;
	svn diff $(eval "find -type f $exts")
}

start-wicd(){
	sudo wicd
	wicd-cli --wireless -c
}

quote(){
	curl --silent http://hackersays.com/quote | json c a
}


# A shortcut function that simplifies usage of xclip.
# - Accepts input from either stdin (pipe), or params.
# ------------------------------------------------
cb() {
  local _scs_col="\e[0;32m"; local _wrn_col='\e[1;31m'; local _trn_col='\e[0;33m'
  # Check that xclip is installed.
  if ! type xclip > /dev/null 2>&1; then
    echo -e "$_wrn_col""You must have the 'xclip' program installed.\e[0m"
  # Check user is not root (root doesn't have access to user xorg server)
  elif [[ "$USER" == "root" ]]; then
    echo -e "$_wrn_col""Must be regular user (not root) to copy a file to the clipboard.\e[0m"
  else
    # If no tty, data should be available on stdin
    if ! [[ "$( tty )" == /dev/* ]]; then
      input="$(< /dev/stdin)"
    # Else, fetch input from params
    else
      input="$*"
    fi
    if [ -z "$input" ]; then  # If no input, print usage message.
      echo "Copies a string or the contents of a file to the clipboard."
      echo "Usage: cb <string or file>"
      echo "       echo <string or file> | cb"
    else
      # Copy input to clipboard
      echo -n "$input" | xclip -selection c
      # Truncate text for status
      if [ ${#input} -gt 80 ]; then input="$(echo $input | cut -c1-80)$_trn_col...\e[0m"; fi
      # Print status.
      echo -e "$_scs_col""Copied to clipboard:\e[0m $input"
    fi
  fi
}

wiki() {
	dig +short txt $1.wp.dg.cx
}

qq-dict() {
	curl -s "http://dict.qq.com/dict?q=$1"
}

givedef(){
    if [[ $# -ge 2 ]] then
        echo "givedef: too many arguments" >&2
        return 1
    else
        curl "dict://dict.org/d:$1"
    fi
}

git-sync() {
	message=$1
	if [ -z "$message" ]; then
		message='sync'
	fi
	git add .
	git ci -am "$message"
	git push
}

min-and-gzipped() {
	uglifyjs $1 | gzip -c | wc -c
}

f(){
	find . -iname "*$1*"
}

runc(){
	cc -Wall -g $1.c -o $1.out && ./$1.out
	rm -f $1.out
}

gitignore(){
	touch .gitignore
	cat  >> .gitignore <<EOF
*.swp
venv
*.pyc
node_modules
npm-debug.log
EOF
}

activate_venv(){
	if [ -z "$VENV_ACTIVATED" ]; then
		echo "activate virtualenv?"
		select yn in "Yes" "No"; do
			case $yn in
				Yes)
					source venv/bin/activate;break;;
				No)
					break;;
			 esac
		done
	else
		echo "venv (from $VENV_ACTIVATED) already activated"
	fi
}

load_env_sh(){
	if [ -z "$ENVSH_SOURCED" ]; then
		echo "source env.sh?"
		select yn in "Yes" "No"; do
			case $yn in
				Yes)
					source env.sh;
					export ENVSH_SOURCED="$(pwd)";
					break;;
				No)
					break;;
			 esac
		done
	else
		echo "env.sh (from $ENVSH_SOURCED) already sourced"
	fi
}

chpwd(){
	if [ -f venv/bin/activate ]; then
		activate_venv
	fi
	if [ -f env.sh ]; then
		load_env_sh
	fi
}

duration(){
	ffprobe "$1" 2>&1 | grep -i duration
}

hourglass(){ trap 'tput cnorm' EXIT INT;local s=$(($SECONDS +$1));(tput civis;while [[ $SECONDS -lt $s ]];do for f in '|' '\' '-' '/';do echo -n "$f" && sleep .2s && echo -n $'\b';done;done;);tput cnorm;}

uncommited(){
	for gitdir in `find ./ -maxdepth 2 -name .git`; 
	do 
		workdir=${gitdir%/*}; 
		echo; 
		echo $workdir; 
		git --git-dir=$gitdir --work-tree=$workdir status; 
	done
}

share(){
	if [ -z "$1" ]; then
		return
	fi
	if [ -f ~/.share-pid ]; then
		if [ kill -0 $(cat ~/.share-pid) > /dev/null 2>&1 ]; then
			echo 'server is running'
		else
			share-start
		fi
	else
		share-start
	fi
	ln -nsf "$(readlink -e "$1")" ~/.share-tmp/
}

share-start(){
	echo 'staring server'
	mkdir ~/.share-tmp
	port=8888
	if [ -n "$1" ]; then
		port=$1
	fi
	cd ~/.share-tmp
	python2 -mSimpleHTTPServer $port &>! ~/.share-log & echo "$!" >! ~/.share-pid
	ls -1
	cd - > /dev/null
}

share-stop(){
	kill $(cat ~/.share-pid) &> /dev/null
	rm -rf ~/.share-tmp
	rm -f ~/.share-pid
}

github-clone(){
	git clone git@github.com:$1/$2.git
}

bitbucket-clone(){
	git clone git@bitbucket.org:$1/$2.git
}

bitbucket-add(){
	git remote add origin ssh://git@bitbucket.org/$1/$2.git
}

mxmlc-release(){
	output=$3
	if [ -z "$output" ]; then
		output=output.swf
	fi
	libpath=$2
	if [ -z "$libpath" ]; then
		libpath=$FLEX_LIB_PATH
	fi
	mxmlc $1\
	 -external-library-path $libpath\
	 -output $output\
	 -default-size=600,400\
	 -default-frame-rate=24\
	 -default-background-color=0xffffff\
	 -static-link-runtime-shared-libraries\
	 -optimize=true\
	 -debug=false
}

mxmlc-debug(){
	output=$3
	if [ -z "$output" ]; then
		output=output.swf
	fi
	libpath=$2
	if [ -z "$libpath" ]; then
		libpath=$FLEX_LIB_PATH
	fi
	mxmlc $1\
	 -external-library-path+=$libpath\
	 -output $output\
	 -default-size=600,400\
	 -default-frame-rate=24\
	 -default-background-color=0xffffff\
	 -static-link-runtime-shared-libraries\
	 -optimize=false\
	 -debug=true
}

rename-after-time(){
	target="$(dirname $1)/$(date -d now +%Y-%m-%d-%H-%M-%S).${1##*.}"
	mv "$1" "$target"
	echo "$target"
}

shot(){
	mplayer -vo jpeg -frames 2 tv:// &> /dev/null
	rm -f 00000001.jpg
	img="$(rename-after-time 00000002.jpg)"
	if [ -n "$1" ]; then
		mv "$img" "$1"
		img="$1/$img"
	fi
	echo "$img"
}


mount-ntfs(){
	mkdir -p $2
	ntfs-3g /dev/$1 $2
	# mount -t ntfs -o nls=utf8,umask=0022,gid=$(id -g),uid=$(id -u)  /dev/$1 $2
}

compress-pdf(){
	gs -sDEVICE=pdfwrite -dCompatibilityLevel=1.4 -dPDFSETTINGS=/screen -dNOPAUSE -dQUIET -dBATCH -sOutputFile=$2 $1
}

concat-pdf(){
	for pdf in $*; do
		pdf2ps $pdf
	done
	rm merged.ps
	cat *.ps > merged.ps
	ps2pdf merged.ps
}


_mux(){
	_arguments ":::($(mux ls | tail -n +2))"
}
compdef _mux mux
